<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Individual - Incobel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #001933, #000000);
      color: white;
      text-align: center;
      padding-top: 80px;
    }
    input {
      padding: 10px;
      font-size: 18px;
      width: 250px;
      border: none;
      border-radius: 8px;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #0074D9;
      color: white;
      cursor: pointer;
      margin-top: 20px;
    }
    iframe {
      margin-top: 30px;
      width: 100%;
      height: 80vh;
      border: none;
      display: none;
    }
    #nome {
      font-size: 20px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Painel Individual Incobel</h1>
  <p>Digite seu CPF (com pontos e hífen):</p>
  <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14">
  <br>
  <button onclick="acessar()">Entrar</button>
  <div id="nome"></div>
  <iframe id="painel"></iframe>

  <script>
    async function acessar() {
      const cpf = document.getElementById("cpf").value.trim();
      if (!/\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}/.test(cpf)) {
        alert("CPF inválido. Use o formato 000.000.000-00");
        return;
      }

      const res = await fetch("https://raw.githubusercontent.com/LogisticaIncobel/indicadores-colaboradores/main/dados.csv");
      const csv = await res.text();
      const linhas = csv.trim().split("\\n").slice(1);
      const encontrado = linhas.map(l => l.split(",")).find(l => l[0] === cpf);

      if (!encontrado) {
        alert("CPF não encontrado.");
        return;
      }

      const nome = encontrado[1];
      document.getElementById("nome").innerText = "Bem-vindo, " + nome;

      const url = "https://app.powerbi.com/reportEmbed?reportId=d3943548-d36d-405a-b692-bb60587e736e&autoAuth=true&ctid=659822cf-7349-4e98-98ce-a7f29833b5c6&filter=Planilha1/CPF eq '" + cpf + "'&mobile=true";

      const iframe = document.getElementById("painel");
      iframe.src = url;
      iframe.style.display = "block";
    }
  </script>
</body>
</html>
