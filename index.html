<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Individual Incobel</title>
  <style>
    body {
      background: linear-gradient(to bottom, #000000, #000d1a);
      color: #ccc;
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 100px;
    }
    h1 {
      font-size: 28px;
      color: #ccc;
    }
    input {
      padding: 10px;
      font-size: 18px;
      width: 250px;
      border-radius: 5px;
      border: none;
      margin-top: 20px;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      margin-top: 20px;
      cursor: pointer;
      border-radius: 5px;
      border: none;
      background-color: #004080;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Painel Individual Incobel</h1>
  <p>Digite seu CPF (com pontos e hífen):</p>
  <input id="cpf" placeholder="000.000.000-00" />
  <br>
  <button onclick="entrar()">Entrar</button>

  <script>
    async function entrar() {
      const cpf = document.getElementById("cpf").value.trim();

      const regex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
      if (!regex.test(cpf)) {
        alert("CPF inválido. Use o formato 000.000.000-00");
        return;
      }

      try {
        const resposta = await fetch("dados.csv");
        const texto = await resposta.text();
        const linhas = texto.split("\n").slice(1);

        let cpfEncontrado = false;
        for (let linha of linhas) {
          const [cpfArquivo] = linha.split(",");
          if (cpfArquivo.trim() === cpf) {
            cpfEncontrado = true;
            break;
          }
        }

        if (!cpfEncontrado) {
          alert("CPF não encontrado.");
          return;
        }

        // ⚠️ Aqui foi corrigido: "Planilha1" é o nome exato da tabela
        const url = `https://app.powerbi.com/reportEmbed?reportId=d3943548-d36d-405a-b692-bb60587e736e&autoAuth=true&ctid=659822cf-7349-4e98-98ce-a7f29833b5c6&filter=Planilha1/CPF eq '${cpf}'&mobile=true`;
        window.location.href = url;
      } catch (erro) {
        alert("Erro ao carregar os dados.");
        console.error(erro);
      }
    }
  </script>
</body>
</html>
